<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Radar Detection Calculator</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#f7f7f8; --card:#ffffff; --accent:#2d7dd2; --text:#111; --muted:#666;
      --control-bg:#fff; --control-border:#d0d0d0;
    }
    .dark{
      --bg:#171717; --card:#1f1f1f; --accent:#5aa6ff; --text:#e8eef8; --muted:#aab0bb;
      --control-bg:#1a1a1a; --control-border:#333;
    }
    body{font-family:Segoe UI,Arial,Helvetica,sans-serif;background:var(--bg);color:var(--text);margin:0;padding:18px;display:flex;justify-content:center;min-height:100vh}
    #radar-calculator{width:100%;max-width:920px;background:var(--card);box-shadow:0 8px 24px rgba(0,0,0,0.12);border-radius:10px;padding:20px}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
    h1{font-size:1.05rem;margin:0}
    .controls{display:flex;gap:8px;align-items:center}
    .row{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:10px}
    .col{flex:1;min-width:220px}
    label{display:block;font-size:0.85rem;margin-bottom:6px;color:var(--muted)}
    select,button,input[type=range]{width:100%;padding:10px;border-radius:8px;border:1px solid var(--control-border);font-size:0.95rem;background:var(--control-bg);color:var(--text)}
    select{appearance:none}
    .btn-primary{background:var(--accent);color:white;border:none;cursor:pointer}
    .btn-ghost{background:transparent;border:1px solid var(--control-border);cursor:pointer}
    #result{margin-top:12px;padding:12px;border-radius:8px;background:rgba(0,0,0,0.03);border:1px solid rgba(0,0,0,0.04);font-weight:700;white-space:pre-line}
    footer{font-size:0.82rem;color:var(--muted);margin-top:12px}
    .top-actions{display:flex;gap:8px;align-items:center}
    .small{font-size:0.85rem;padding:8px;border-radius:8px}
    .slider-labels{display:flex;justify-content:space-between;font-size:0.8rem;color:var(--muted);margin-top:4px}
    @media (max-width:560px){ .row{flex-direction:column} .controls{flex-direction:column-reverse} }
  </style>
</head>
<body class="dark">
  <div id="radar-calculator" role="application" aria-label="Radar Detection Calculator">
    <header>
      <div>
        <h1>Radar Detection Calculator</h1>
        <div style="color:var(--muted);font-size:0.88rem">Choose a transmitting plane and a detected plane, then Calculate.</div>
      </div>
      <div class="controls">
        <div class="top-actions">
          <button id="downloadPy" class="small btn-ghost" title="Download the Python/Tkinter source">Download</button>
          <button id="themeToggle" class="small btn-ghost" title="Toggle dark / light">Light mode</button>
        </div>
      </div>
    </header>

    <div class="row">
      <div class="col">
        <label for="txSelect">Transmitting Plane</label>
        <select id="txSelect"><option value="">Select transmitting plane…</option></select>
      </div>
      <div class="col">
        <label for="rxSelect">Detected Plane</label>
        <select id="rxSelect"><option value="">Select detected plane…</option></select>
      </div>
    </div>

    <div class="row">
      <div class="col">
        <label for="sortMode">Sort Detected By</label>
        <input type="range" id="sortMode" min="0" max="2" step="1" value="0"/>
        <div class="slider-labels"><span>Front</span><span>Side</span><span>Avg</span></div>
      </div>
      <div class="col" style="display:flex;align-items:flex-end">
        <button id="sortOrder" class="btn-ghost">Descending</button>
      </div>
    </div>

    <div style="display:flex;gap:12px;margin-bottom:6px">
      <button id="calcBtn" class="btn-primary">Calculate</button>
      <button id="resetBtn" class="btn-ghost">Reset</button>
    </div>

    <div id="result" aria-live="polite">Front: -- km / -- NM<br>Side: -- km / -- NM</div>
    <button id="copyBtn" class="btn-ghost" style="margin-top:8px">Copy Result</button>

    <footer>Hosted with GitHub Pages — copy the page URL to share.</footer>
  </div>

  <script>
  // ---------------- FULL DATASET ----------------
  const DATA = [
    {"name":"AN/APG-81","hotRange":550,"coldRange":480,"availablePlane":"F-35A Block 3F","frontRCS":0.00015,"sideRCS":0.0005},
    {"name":"AN/APG-82(V)1","hotRange":320,"coldRange":250,"availablePlane":"F-15E Strike Eagle","frontRCS":16,"sideRCS":12},
    {"name":"AN/APG-63(V)3","hotRange":230,"coldRange":180,"availablePlane":"F-15C Golden Eagle","frontRCS":25,"sideRCS":15},
    {"name":"N007AM Zaslon-AM","hotRange":220,"coldRange":160,"availablePlane":"MiG-31BM Foxhound","frontRCS":15,"sideRCS":25},
    {"name":"KLJ-10","hotRange":190,"coldRange":160,"availablePlane":"J-10C Vigorous Dragon","frontRCS":0.75,"sideRCS":3},
    {"name":"AN/AWG-9","hotRange":180,"coldRange":43,"availablePlane":["F-14A Tomcat","F-14B Tomcat"],"frontRCS":6,"sideRCS":16},
    {"name":"CAPTOR-M","hotRange":180,"coldRange":160,"availablePlane":["EF2000","Eurofighter Typhoon"],"frontRCS":1.2,"sideRCS":75},
    {"name":"N035 Irbis-E","hotRange":180,"coldRange":120,"availablePlane":"Su-35S Flanker-M","frontRCS":10,"sideRCS":22},
    {"name":"RBE2-AA","hotRange":170,"coldRange":130,"availablePlane":"Rafale C F4","frontRCS":0.8,"sideRCS":4},
    {"name":"AN/APG-83","hotRange":170,"coldRange":160,"availablePlane":"F-16CM Block 42+ PoBIT","frontRCS":1.2,"sideRCS":4},
    {"name":"N036","hotRange":160,"coldRange":140,"availablePlane":"Su-57M Felon","frontRCS":0.1,"sideRCS":1.5},
    {"name":"AN/APG-63(V)1","hotRange":160,"coldRange":130,"availablePlane":"F-15J(M) MTDP Eagle","frontRCS":25,"sideRCS":15},
    {"name":["AN/APG-63","AN/APG-63 PSP"],"hotRange":140,"coldRange":120,"availablePlane":["F-15J J-MSIP Eagle","F-15C MSIP II Eagle"],"frontRCS":25,"sideRCS":15},
    {"name":"AN/APG-68(V)9","hotRange":136,"coldRange":119,"availablePlane":"F-16C Block 52+","frontRCS":3,"sideRCS":6},
    {"name":"N010M Zhuk-M","hotRange":117,"coldRange":80,"availablePlane":"MiG-29SMT Fulcrum","frontRCS":4,"sideRCS":8},
    {"name":"RDY-2","hotRange":112,"coldRange":105,"availablePlane":"Mirage 2000-5F","frontRCS":3,"sideRCS":7},
    {"name":"N001VP Mech","hotRange":111,"coldRange":93,"availablePlane":"Su-27SM3 Flanker-J2","frontRCS":15,"sideRCS":22},
    {"name":"AN/APG-73","hotRange":110,"coldRange":90,"availablePlane":"F/A-18C Hornet","frontRCS":5,"sideRCS":8},
    {"name":"J/APG-2","hotRange":110,"coldRange":82,"availablePlane":"F-2A Viper Zero","frontRCS":1.7,"sideRCS":6},
    {"name":"AN/APG-68(V)7","hotRange":105,"coldRange":92,"availablePlane":"F-16CM Block 50","frontRCS":3,"sideRCS":6},
    {"name":["AN/AWG-11","AN/APG-59"],"hotRange":95,"coldRange":6,"availablePlane":["Phantom FG.1","F-4J Phantom II"],"frontRCS":7,"sideRCS":10},
    {"name":"AI.24 Foxhunter","hotRange":94,"coldRange":77,"availablePlane":["Tornado F.3","Tornado F.3 FSP"],"frontRCS":9,"sideRCS":16},
    {"name":"AN/APG-68(V)5","hotRange":92,"coldRange":50,"availablePlane":"F-16CG Block 40","frontRCS":3,"sideRCS":6},
    {"name":["AN/APQ-120","AN/APQ-120(V)5"],"hotRange":83,"coldRange":46,"availablePlane":["F-4E Phantom II","F-4F Phantom II"],"frontRCS":7,"sideRCS":10},
    {"name":"Type 1492","hotRange":79,"coldRange":64,"availablePlane":"J-8F Finback","frontRCS":5,"sideRCS":12},
    {"name":"AN/APG-66J","hotRange":76,"coldRange":60,"availablePlane":"F-4EJ Kai Phantom II","frontRCS":7,"sideRCS":10},
    {"name":"AN/APG-65","hotRange":74,"coldRange":58,"availablePlane":"F/A-18A Hornet","frontRCS":5,"sideRCS":8},
    {"name":"KLJ-3","hotRange":72,"coldRange":62,"availablePlane":"J-10A Vigorous Dragon","frontRCS":2.5,"sideRCS":4},
    {"name":"N001 Mech","hotRange":68,"coldRange":25,"availablePlane":"Su-27P Flanker-B","frontRCS":15,"sideRCS":22},
    {"name":"AN/APG-66A","hotRange":64,"coldRange":59,"availablePlane":"F-16A ADF Block 15","frontRCS":3.2,"sideRCS":6.3},
    {"name":"RDI","hotRange":55,"coldRange":24,"availablePlane":"Mirage 2000-S5","frontRCS":3,"sideRCS":7},
    {"name":"N036Kh","hotRange":50,"coldRange":45,"availablePlane":"Su-57M Felon","frontRCS":0.1,"sideRCS":1.5},
    {"name":"Sapfir-23MLA-II","hotRange":42,"coldRange":30,"availablePlane":"MiG-23MLD","frontRCS":9,"sideRCS":16},
    {"name":"AN/APG-148","hotRange":40,"coldRange":4,"availablePlane":"A-6E Intruder","frontRCS":7,"sideRCS":12},
    {"name":"N036B","hotRange":40,"coldRange":37,"availablePlane":"Su-57M Felon","frontRCS":0.1,"sideRCS":1.5},
    {"name":"N019 Rubin","hotRange":29,"coldRange":17,"availablePlane":"MiG-29 9.12 Fulcrum","frontRCS":4,"sideRCS":8},
    {"name":"Cyrano II","hotRange":23,"coldRange":17,"availablePlane":"Mirage IIIE","frontRCS":7,"sideRCS":11},
    {"name":"J/AWG-12","hotRange":23,"coldRange":17,"availablePlane":"Mitsubishi F-1","frontRCS":7,"sideRCS":10},
    {"name":"AN/APQ-94","hotRange":22,"coldRange":16,"availablePlane":"F-8E Crusader","frontRCS":6,"sideRCS":9},
    {"name":"AI.23","hotRange":19,"coldRange":15,"availablePlane":"Lightning F.6","frontRCS":7,"sideRCS":12},
    {"name":"RP-22","hotRange":18,"coldRange":12,"availablePlane":"MiG-21bis","frontRCS":5,"sideRCS":12},
    {"name":"NASARR F-15A","hotRange":17,"coldRange":14,"availablePlane":"F-104G Starfighter","frontRCS":5,"sideRCS":9},
    {"name":"AN/APQ-159","hotRange":15,"coldRange":8,"availablePlane":"F-5E Tiger II","frontRCS":4,"sideRCS":8},
    {"name":null,"hotRange":0,"coldRange":0,"availablePlane":"Su-25","frontRCS":12,"sideRCS":16},
    {"name":null,"hotRange":0,"coldRange":0,"availablePlane":"MiG-27K","frontRCS":8,"sideRCS":15},
    {"name":null,"hotRange":0,"coldRange":0,"availablePlane":"A-10A Thunderbolt II","frontRCS":12,"sideRCS":16},
    {"name":null,"hotRange":0,"coldRange":0,"availablePlane":"Alpha Jet A","frontRCS":5,"sideRCS":8},
    {"name":null,"hotRange":0,"coldRange":0,"availablePlane":"Zu-57 Felon","frontRCS":1e-7,"sideRCS":1.5e-7}
  ];

  // ---------------- Utility Helpers ----------------
  function iterPlanes(e){return Array.isArray(e.availablePlane)?e.availablePlane:[e.availablePlane];}
  function iterRadars(e){return Array.isArray(e.name)?e.name:[e.name];}
  function kmToNm(km){return (km*0.539957).toFixed(1);}
  function rcsFactor(rcs){return Math.sqrt(rcs);}
  function rangeKm(hotRange,factor){return (hotRange*Math.pow(factor,-0.25)).toFixed(1);}

  // ---------------- Populate Dropdowns ----------------
  const txSelect=document.getElementById("txSelect");
  const rxSelect=document.getElementById("rxSelect");
  let sortMode=0,sortDescending=true;

  function populate(){
    txSelect.length=1; rxSelect.length=1;
    DATA.forEach(e=>{
      iterPlanes(e).forEach(p=>{
        let label=p;
        if(e.name){
          const radars=iterRadars(e);
          if(radars.length>1) label+=` (${radars[0]})`; // show radar only if multiple
        }
        const o=document.createElement("option");
        o.value=label; o.textContent=label;
        txSelect.appendChild(o);
      });
    });

    // sort detected planes
    let stats={};
    DATA.forEach(e=>{
      const f=e.frontRCS||0, s=e.sideRCS||0, avg=(f+s)/2;
      iterPlanes(e).forEach(p=>{
        if(!stats[p]) stats[p]={front:0,side:0,avg:0};
        stats[p].front=Math.max(stats[p].front,f);
        stats[p].side=Math.max(stats[p].side,s);
        stats[p].avg=Math.max(stats[p].avg,avg);
      });
    });
    let key=["front","side","avg"][sortMode];
    let sorted=Object.entries(stats).sort((a,b)=>
      sortDescending?b[1][key]-a[1][key]:a[1][key]-b[1][key]);
    sorted.forEach(([opt])=>{
      const o=document.createElement("option");o.value=opt;o.textContent=opt;rxSelect.appendChild(o);
    });
  }

  function parseTxLabel(label){
    if(!label)return[null,null];
    const idx=label.lastIndexOf(" (");
    if(idx!==-1&&label.endsWith(")"))return[label.substring(0,idx).trim(),label.substring(idx+2,label.length-1).trim()];
    return[label.trim(),null];
  }

  function findTxEntry(plane,radar){
    if(!plane)return null;
    if(radar){for(const e of DATA){if(iterPlanes(e).includes(plane)&&iterRadars(e).includes(radar))return e;}return null;}
    let best=null,bestHot=-1;
    for(const e of DATA){if(e.name)for(const p of iterPlanes(e)){if(p===plane&&(e.hotRange||0)>bestHot){bestHot=e.hotRange;best=e;}}}
    return best;
  }

  function findRxEntry(plane){
    let best=null,bestFront=-1;
    for(const e of DATA){for(const p of iterPlanes(e)){if(p===plane&&(e.frontRCS||0)>bestFront){bestFront=e.frontRCS;best=e;}}}
    return best;
  }

  function calculateRadar(){
    const [plane,radar]=parseTxLabel(txSelect.value);
    const tx=findTxEntry(plane,radar),rx=findRxEntry(rxSelect.value);
    if(!tx||!rx){resultDiv.innerHTML="Front: N/A<br>Side: N/A";return;}
    const hot=tx.hotRange,f=rx.frontRCS,s=rx.sideRCS;
    if(!hot||!f||!s){resultDiv.innerHTML="Front: N/A<br>Side: N/A";return;}
    const fk=rangeKm(hot,rcsFactor(f)),sk=rangeKm(hot,rcsFactor(s));
    resultDiv.innerHTML=`Front: ${fk} km / ${kmToNm(fk)} NM<br>Side: ${sk} km / ${kmToNm(sk)} NM`;
  }

  const resultDiv=document.getElementById("result");
  document.getElementById("calcBtn").addEventListener("click",calculateRadar);
  document.getElementById("resetBtn").addEventListener("click",()=>{txSelect.selectedIndex=0;rxSelect.selectedIndex=0;resultDiv.innerHTML="Front: -- km / -- NM<br>Side: -- km / -- NM";});
  document.getElementById("copyBtn").addEventListener("click",()=>{navigator.clipboard.writeText(resultDiv.innerText);alert("Result copied!");});

  document.getElementById("sortMode").addEventListener("input",e=>{sortMode=parseInt(e.target.value);populate();});
  document.getElementById("sortOrder").addEventListener("click",()=>{sortDescending=!sortDescending;document.getElementById("sortOrder").textContent=sortDescending?"Descending":"Ascending";populate();});

  // Theme toggle
  const themeToggle=document.getElementById("themeToggle");
  themeToggle.addEventListener("click",()=>{document.body.classList.toggle("dark");themeToggle.textContent=document.body.classList.contains("dark")?"Light mode":"Dark mode";});

  // ---------------- Python Download ----------------
  const pySource = `import tkinter as tk
from tkinter import messagebox
import math

DATA = ${JSON.stringify(DATA,null,2)}

class RadarApp(tk.Tk):
    def __init__(self):
        super().__init__()
        self.title("Radar Detection Calculator")
        self.configure(bg="#1f1f1f")
        self.geometry("640x480")

        self.sort_mode = tk.IntVar(value=0)
        self.sort_desc = True

        tk.Label(self,text="Transmitting Plane",fg="white",bg="#1f1f1f").pack()
        self.tx_var=tk.StringVar()
        self.tx_menu=tk.OptionMenu(self,self.tx_var,*self.tx_options())
        self.tx_menu.pack()

        tk.Label(self,text="Detected Plane",fg="white",bg="#1f1f1f").pack()
        self.rx_var=tk.StringVar()
        self.rx_menu=tk.OptionMenu(self,self.rx_var,*self.rx_options())
        self.rx_menu.pack()

        tk.Label(self,text="Sort Detected By (0=Front,1=Side,2=Avg)",fg="white",bg="#1f1f1f").pack()
        tk.Scale(self,from_=0,to=2,orient="horizontal",variable=self.sort_mode,command=lambda e:self.refresh_rx()).pack(fill="x")

        self.order_btn=tk.Button(self,text="⬆",command=self.toggle_order)
        self.order_btn.pack()

        tk.Button(self,text="Calculate",command=self.calculate).pack()
        tk.Button(self,text="Reset",command=self.reset).pack()
        tk.Button(self,text="Copy Result",command=self.copy_result).pack()

        self.result_lbl=tk.Label(self,text="Front: -- km / -- NM\\nSide: -- km / -- NM",fg="white",bg="#1f1f1f")
        self.result_lbl.pack(pady=10)

    def tx_options(self):
        opts=[]
        for e in DATA:
            planes=e.get("availablePlane",[])
            if not isinstance(planes,list):planes=[planes]
            for p in planes:
                if e.get("name") and isinstance(e["name"],list) and len(e["name"])>1:
                    opts.append(f"{p} ({e['name'][0]})")
                else:
                    opts.append(p)
        return opts

    def rx_options(self):
        stats={}
        for e in DATA:
            f,s=e.get("frontRCS",0),e.get("sideRCS",0)
            avg=(f+s)/2
            planes=e.get("availablePlane",[])
            if not isinstance(planes,list):planes=[planes]
            for p in planes:
                if p not in stats:stats[p]={"front":0,"side":0,"avg":0}
                stats[p]["front"]=max(stats[p]["front"],f)
                stats[p]["side"]=max(stats[p]["side"],s)
                stats[p]["avg"]=max(stats[p]["avg"],avg)
        key=["front","side","avg"][self.sort_mode.get()]
        return [p for p,_ in sorted(stats.items(),key=lambda kv:kv[1][key],reverse=self.sort_desc)]

    def refresh_rx(self):
        menu=self.rx_menu["menu"]
        menu.delete(0,"end")
        for opt in self.rx_options():
            menu.add_command(label=opt,command=tk._setit(self.rx_var,opt))

    def toggle_order(self):
        self.sort_desc=not self.sort_desc
        self.order_btn.config(text="⬆" if self.sort_desc else "⬇")
        self.refresh_rx()

    def calculate(self):
        tx=self.tx_var.get()
        rx=self.rx_var.get()
        if not tx or not rx:
            self.result_lbl.config(text="Front: N/A\\nSide: N/A")
            return
        # find entries
        tx_entry=None
        for e in DATA:
            planes=e.get("availablePlane",[])
            if not isinstance(planes,list):planes=[planes]
            if tx.split(" (")[0] in planes:
                tx_entry=e;break
        rx_entry=None
        for e in DATA:
            planes=e.get("availablePlane",[])
            if not isinstance(planes,list):planes=[planes]
            if rx in planes:
                rx_entry=e;break
        if not tx_entry or not rx_entry:
            self.result_lbl.config(text="Front: N/A\\nSide: N/A");return
        hot=tx_entry.get("hotRange",0)
        f=rx_entry.get("frontRCS",0);s=rx_entry.get("sideRCS",0)
        if not hot or not f or not s:
            self.result_lbl.config(text="Front: N/A\\nSide: N/A");return
        fk=hot*(f**-0.25);sk=hot*(s**-0.25)
        text=f"Front: {fk:.1f} km / {fk*0.539957:.1f} NM\\nSide: {sk:.1f} km / {sk*0.539957:.1f} NM"
        self.result_lbl.config(text=text)
        self._last=text

    def reset(self):
        self.tx_var.set("");self.rx_var.set("")
        self.result_lbl.config(text="Front: -- km / -- NM\\nSide: -- km / -- NM")

    def copy_result(self):
        self.clipboard_clear()
        self.clipboard_append(getattr(self,"_last",""))
        messagebox.showinfo("Copied","Result copied to clipboard")

if __name__=="__main__":
    app=RadarApp();app.mainloop()`;

  document.getElementById("downloadPy").addEventListener("click",()=>{
    const blob=new Blob([pySource],{type:"text/x-python"});
    const url=URL.createObjectURL(blob);
    const a=document.createElement("a");
    a.href=url;a.download="radar_calculator.pyw";a.click();
    URL.revokeObjectURL(url);
  });

  // Init
  populate();
  </script>
</body>
</html>
